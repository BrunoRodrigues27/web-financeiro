<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle Financeiro</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

<style>
* { box-sizing: border-box; }

body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    padding: 12px;
}

h1, h2 {
    text-align: center;
    color: #38bdf8;
}

h2 {
    font-size: 20px;
}

h3 {
    padding-left: 10px;
    margin: 0;
    margin-bottom: 15px;
    color: #38bdf8;
    font-size: 16px;
}

.container {
    background: #020617;
    padding: 12px;
    border-radius: 10px;
}

.section {
    margin-bottom: 20px;
    padding: 12px;
    border: 1px solid #1e293b;
    border-radius: 8px;
}

.salario-exibicao {
    background: #1e293b;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    margin-bottom: 15px;
    border: 2px solid #38bdf8;
    position: sticky;
    top: 10px;
    z-index: 100;
}

.salario-exibicao span {
    font-size: 1.2em;
    font-weight: bold;
    color: #38bdf8;
}

label {
    display: block;
    margin-top: 10px;
    font-size: 14px;
    color: #94a3b8;
}

input, select, button {
    width: 100%;
    padding: 12px;
    margin-top: 4px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
}

button {
    background: #38bdf8;
    color: #020617;
    font-weight: bold;
    cursor: pointer;
}

button.secundario { background: #64748b; color: #fff; }
button.excluir { background: #ef4444; color: #fff; }
button.editar { background: #38bdf8; color: #020617; }

.botoes {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.pago { color: #22c55e; font-weight: bold; }
.nao { color: #ef4444; font-weight: bold; }
.positivo { color: #22c55e; }
.negativo { color: #ef4444; }

/* --- NOVO ESTILO DOS CARDS DE ITENS (IMAGEM 2) --- */
.lista-container {
    margin-top: 15px;
}

.item-card {
    background: #0f172a;
    border: 1px solid #1e293b;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
}

.item-linha {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 15px;
}

.item-label {
    color: #94a3b8;
    font-weight: bold;
}

.item-valor-foco {
    font-weight: bold;
    color: #e5e7eb;
}

.acoes-card {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 10px;
}

/* --- ESTILO RESUMO (IMAGEM 1) --- */
.resumo-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

.resumo-card {
    background: #020617;
    border: 1px solid #1e293b;
    border-radius: 12px;
    padding: 15px;
}

.resumo-card.destaque {
    border: 2px solid #38bdf8;
    position: relative;
}

.resumo-linha {
    display: grid;
    grid-template-columns: 1fr 100px 65px 20px;
    align-items: center;
    margin-bottom: 10px;
    font-size: 15px;
    gap: 8px;
}

.resumo-linha span {
    color: #e5e7eb;
}

.resumo-linha strong {
    text-align: right;
}

.resumo-linha .perc-valor {
    color: #94a3b8;
    font-weight: normal;
}

.resumo-linha .qtd-valor {
    color: #38bdf8;
    font-weight: bold;
}

.linha-tracejada {
    border-top: 1px dashed #334155;
    margin: 10px 0;
}

.total-label {
    color: #94a3b8 !important;
}

#status-humor {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 18px;
}

#toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
}

.toast {
    background: #1e293b;
    color: #fff;
    padding: 15px 20px;
    border-radius: 8px;
    border-left: 6px solid #38bdf8;
    margin-bottom: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}

#confirm-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    z-index: 10001;
    align-items: center;
    justify-content: center;
}

.confirm-box {
    background: #020617;
    border: 2px solid #38bdf8;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    max-width: 320px;
    width: 90%;
}

.status-vermelho { color: #ef4444; font-weight: bold; margin-right: 5px; }
.status-amarelo { color: #fbbf24; font-weight: bold; margin-right: 5px; }
.status-verde { color: #22c55e; font-weight: bold; margin-right: 5px; }

</style>
</head>

<body>

<div id="toast-container"></div>

<div id="confirm-overlay">
    <div class="confirm-box">
        <h3 id="confirm-title">Confirmar</h3>
        <p id="confirm-msg" style="margin-bottom: 20px;"></p>
        <div class="botoes">
            <button id="confirm-yes" class="excluir">Confirmar</button>
            <button id="confirm-no" class="secundario">Cancelar</button>
        </div>
    </div>
</div>

<h1>ğŸ“Š Controle Financeiro</h1>

<div class="container">

<div class="salario-exibicao">
    ğŸ’° SalÃ¡rio registrado: <span id="displaySalario">R$ 0,00</span>
    <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center;">
        <select id="selectMes">
            <option value="" disabled selected>MÃªs</option>
            <option value="1">Janeiro</option><option value="2">Fevereiro</option><option value="3">MarÃ§o</option>
            <option value="4">Abril</option><option value="5">Maio</option><option value="6">Junho</option>
            <option value="7">Julho</option><option value="8">Agosto</option><option value="9">Setembro</option>
            <option value="10">Outubro</option><option value="11">Novembro</option><option value="12">Dezembro</option>
        </select>
        <select id="selectAno" style="width: 100px;">
            <option value="" disabled selected>Ano</option>
        </select>
        <button class="excluir" onclick="zerarTudo()" style="width: 150px;">ğŸ§¹ Zerar</button>
    </div>
</div>

<div class="section">
    <h2>ğŸ’° Configurar SalÃ¡rio</h2>
    <input type="text" id="salarioInput" placeholder="ğŸ’² Digite seu salÃ¡rio" oninput="mascaraMoeda(this)" maxlength="12">
    <button onclick="definirSalario()">Salvar salÃ¡rio</button>
</div>

<div class="section">
    <h2>ğŸ§¾ Despesas</h2>
    <input id="nomeDespesa" placeholder="ğŸ“ Nome da conta" maxlength="40">
    <input id="valorDespesa" type="text" placeholder="ğŸ’² Valor" oninput="mascaraMoeda(this)">
    <select id="tipoDespesa">
        <option value="" disabled selected>ğŸ“Œ Tipo</option>
        <option value="fixa">ğŸ§¾ Fixa</option>
        <option value="pontual">ğŸ§¾ Pontual</option>
    </select>
    <label>ğŸ“… Vencimento</label>
    <input type="date" id="vencimentoDespesa">
    <select id="statusDespesa" onchange="atualizarCampoPagamento()">
        <option value="" disabled selected>Status</option>
        <option value="nao">âŒ NÃ£o pago</option>
        <option value="pago">âœ… Pago</option>
    </select>
    <div id="campoPagamento" style="display:none">
        <label>ğŸ“… Pagamento</label>
        <input type="date" id="pagamentoDespesa">
    </div>
    <div class="botoes">
        <button id="btnDespesa" onclick="salvarDespesa()">Salvar despesa</button>
        <button id="btnNovaDespesa" class="secundario" onclick="novaDespesa()" style="display:none">Nova despesa</button>
    </div>
    <div id="listaDespesas" class="lista-container"></div>
</div>

<div class="section">
    <h2>ğŸ¡ Lazer</h2>
    <input id="nomeLazer" placeholder="ğŸ“ DescriÃ§Ã£o do lazer" maxlength="40">
    <input id="valorLazer" type="text" placeholder="ğŸ’² Valor" oninput="mascaraMoeda(this)">
    <label>ğŸ“… Data</label>
    <input type="date" id="dataLazer">
    <div class="botoes">
        <button id="btnLazer" onclick="salvarLazer()">Salvar lazer</button>
        <button id="btnNovoLazer" class="secundario" onclick="novoLazer()" style="display:none">Novo lazer</button>
    </div>
    <div id="listaLazer" class="lista-container"></div>
</div>

<div class="section">
    <h2>ğŸ¯ Metas</h2>
    <input id="nomeMeta" placeholder="ğŸ“ Nome da meta" maxlength="40">
    <input id="valorMeta" type="text" placeholder="ğŸ’² Valor" oninput="mascaraMoeda(this)">
    <label>ğŸ“… Data</label>
    <input type="date" id="dataMeta">
    <div class="botoes">
        <button id="btnMeta" onclick="salvarMeta()">Salvar meta</button>
        <button id="btnNovaMeta" class="secundario" onclick="novaMeta()" style="display:none">Nova meta</button>
    </div>
    <div id="listaMetas" class="lista-container"></div>
</div>

<div class="section">
    <h2>ğŸ’ Reservas | ğŸ“ˆ Investimentos</h2>
    <input id="nomeInv" placeholder="ğŸ“ Nome" maxlength="40">
    <input id="valorInv" type="text" placeholder="ğŸ’² Valor" oninput="mascaraMoeda(this)">
    <select id="tipoInv">
        <option value="" disabled selected>ğŸ“Œ Tipo</option>
        <option value="reserva">ğŸ’ Reserva</option>
        <option value="emergencia">ğŸ†˜ Reserva de EmergÃªncia</option>
        <option value="investimento">ğŸ“ˆ Investimento</option>
    </select>
    <label>ğŸ“… Data</label>
    <input type="date" id="dataInv">
    <div class="botoes">
        <button id="btnInvest" onclick="salvarInvestimento()">Salvar aporte</button>
        <button id="btnNovoInvest" class="secundario" onclick="novoInvestimento()" style="display:none">Novo aporte</button>
    </div>
    <div id="listaInvestimentos" class="lista-container"></div>
</div>

<div class="section">
    <h2>ğŸ“Š Resumo</h2>
    <div class="resumo-grid">
        
        <div class="resumo-card">
            <h3>ğŸ§¾ Despesas</h3>
            <div class="resumo-linha">
                <span>âœ… Pago</span>
                <strong id="totalPago">R$ 0,00</strong>
                <strong class="perc-valor" id="percPago">0%</strong>
                <strong class="qtd-valor" id="qtdPago">0</strong>
            </div>
            <div class="resumo-linha">
                <span>âŒ NÃ£o pago</span>
                <strong id="totalPendente">R$ 0,00</strong>
                <strong class="perc-valor" id="percPendente">0%</strong>
                <strong class="qtd-valor" id="qtdPendente">0</strong>
            </div>
            <div class="linha-tracejada"></div>
            <div class="resumo-linha">
                <span class="total-label">Soma Total</span>
                <strong id="somaDespesasValor">R$ 0,00</strong>
                <strong class="perc-valor" id="somaDespesasPerc">0%</strong>
                <strong class="qtd-valor" id="qtdTotalDespesas">0</strong>
            </div>
        </div>

        <div class="resumo-card">
            <h3>ğŸ¡ Lazer</h3>
            <div class="resumo-linha">
                <span>ğŸ¡ Gastos Lazer</span>
                <strong id="totalLazer">R$ 0,00</strong>
                <strong class="perc-valor" id="percLazer">0%</strong>
                <strong class="qtd-valor" id="qtdLazer">0</strong>
            </div>
            <div class="linha-tracejada"></div>
            <div class="resumo-linha">
                <span class="total-label">Soma Total</span>
                <strong id="somaLazerValor">R$ 0,00</strong>
                <strong class="perc-valor" id="somaLazerPerc">0%</strong>
                <strong class="qtd-valor" id="somaLazerQtd">0</strong>
            </div>
        </div>

        <div class="resumo-card">
            <h3>ğŸ¯ Metas</h3>
            <div class="resumo-linha">
                <span>ğŸ¯ Aportes Metas</span>
                <strong id="totalMetas">R$ 0,00</strong>
                <strong class="perc-valor" id="percMetas">0%</strong>
                <strong class="qtd-valor" id="qtdMetas">0</strong>
            </div>
            <div class="linha-tracejada"></div>
            <div class="resumo-linha">
                <span class="total-label">Soma Total</span>
                <strong id="somaMetasValor">R$ 0,00</strong>
                <strong class="perc-valor" id="somaMetasPerc">0%</strong>
                <strong class="qtd-valor" id="somaMetasQtd">0</strong>
            </div>
        </div>

        <div class="resumo-card">
            <h3>ğŸ’ Reservas | Investimentos</h3>
            <div class="resumo-linha"><span>ğŸ†˜ EmergÃªncia</span><strong id="totalEmergencia">R$ 0,00</strong><strong class="perc-valor" id="percEmergencia">0%</strong><strong class="qtd-valor" id="qtdEmergencia">0</strong></div>
            <div class="resumo-linha"><span>ğŸ’ Reservas</span><strong id="totalReservas">R$ 0,00</strong><strong class="perc-valor" id="percReservas">0%</strong><strong class="qtd-valor" id="qtdReservas">0</strong></div>
            <div class="resumo-linha"><span>ğŸ“ˆ Investimento</span><strong id="totalInvest">R$ 0,00</strong><strong class="perc-valor" id="percInvest">0%</strong><strong class="qtd-valor" id="qtdInvest">0</strong></div>
            <div class="linha-tracejada"></div>
            <div class="resumo-linha">
                <span class="total-label">Soma Total</span>
                <strong id="somaInvValor">R$ 0,00</strong>
                <strong class="perc-valor" id="somaInvPerc">0%</strong>
                <strong class="qtd-valor" id="qtdTotalInv">0</strong>
            </div>
        </div>

        <div class="resumo-card destaque">
            <div id="status-humor"></div>
            <h3>ğŸ’µ Saldo</h3>
            <div class="resumo-linha" style="grid-template-columns: 1fr 110px 65px;">
                <span>DisponÃ­vel</span>
                <strong id="saldoFinal" class="positivo">R$ 0,00</strong>
                <strong class="perc-valor" id="percLivre" style="text-align:right">0%</strong>
            </div>
        </div>
    </div>
</div>

</div>

<script>
let salario = 0;
let despesas = [], lazer = [], metas = [], investimentos = [];
let editDespesa = null, editLazer = null, editMeta = null, editInvest = null;

function mascaraMoeda(i) {
    let v = i.value.replace(/\D/g,'');
    v = (v/100).toFixed(2) + '';
    v = v.replace(".", ",");
    v = v.replace(/(\d)(\d{3})(\d{3}),/g, "$1.$2.$3,");
    v = v.replace(/(\d)(\d{3}),/g, "$1.$2,");
    i.value = v;
}

const parseBRL = (v) => v ? Number(v.replace(/\./g, '').replace(',', '.')) : 0;
const real = v => v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
function formatarDataBR(data){ if(!data) return "-"; const [a,m,d] = data.split("-"); return `${d}/${m}/${a}`; }
function calcularPercentual(valor){ return salario <= 0 ? "0.00%" : ((valor / salario) * 100).toFixed(2) + "%"; }

function avisar(msg, cor = "#38bdf8") {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast'; toast.style.borderLeftColor = cor; toast.innerText = msg;
    container.appendChild(toast);
    setTimeout(() => { toast.style.opacity = '0'; setTimeout(()=>toast.remove(), 500); }, 3000);
}

function perguntar(msg, acao) {
    const overlay = document.getElementById('confirm-overlay');
    document.getElementById('confirm-msg').innerText = msg;
    overlay.style.display = 'flex';
    document.getElementById('confirm-yes').onclick = () => { acao(); overlay.style.display = 'none'; };
    document.getElementById('confirm-no').onclick = () => { overlay.style.display = 'none'; };
}

function definirSalario(){
    salario = parseBRL(salarioInput.value);
    if(salario <= 0) return avisar("âš ï¸ Informe um valor", "#ef4444");
    salarioInput.value = ""; atualizarTudo(); avisar("ğŸ’° SalÃ¡rio salvo!", "#22c55e");
}

function atualizarCampoPagamento(){ campoPagamento.style.display = statusDespesa.value === "pago" ? "block" : "none"; }

// SALVAR FUNÃ‡Ã•ES
function salvarDespesa(){
    const d = { nome: nomeDespesa.value, valor: parseBRL(valorDespesa.value), tipo: tipoDespesa.value, venc: vencimentoDespesa.value, pag: statusDespesa.value === "pago" ? pagamentoDespesa.value : "", status: statusDespesa.value };
    if(!d.nome || d.valor <= 0) return avisar("âš ï¸ Preencha os campos");
    if(editDespesa === null) despesas.push(d); else despesas[editDespesa] = d;
    novaDespesa(); atualizarTudo();
}
function novaDespesa(){ editDespesa = null; nomeDespesa.value = ""; valorDespesa.value = ""; tipoDespesa.value = ""; vencimentoDespesa.value = ""; statusDespesa.value = ""; atualizarCampoPagamento(); btnDespesa.innerText = "Salvar despesa"; btnNovaDespesa.style.display = "none"; }
function editarDespesa(i){ const d = despesas[i]; nomeDespesa.value = d.nome; valorDespesa.value = d.valor.toLocaleString('pt-BR',{minimumFractionDigits:2}); tipoDespesa.value = d.tipo; vencimentoDespesa.value = d.venc; statusDespesa.value = d.status; atualizarCampoPagamento(); editDespesa = i; btnDespesa.innerText = "Atualizar"; btnNovaDespesa.style.display = "block"; }

function salvarLazer(){
    const l = { nome: nomeLazer.value, valor: parseBRL(valorLazer.value), data: dataLazer.value };
    if(!l.nome || l.valor <= 0) return avisar("âš ï¸ Preencha os campos");
    if(editLazer === null) lazer.push(l); else lazer[editLazer] = l;
    novoLazer(); atualizarTudo();
}
function novoLazer(){ editLazer = null; nomeLazer.value = ""; valorLazer.value = ""; dataLazer.value = ""; btnLazer.innerText = "Salvar lazer"; btnNovoLazer.style.display = "none"; }
function editarLazer(i){ const l = lazer[i]; nomeLazer.value = l.nome; valorLazer.value = l.valor.toLocaleString('pt-BR',{minimumFractionDigits:2}); dataLazer.value = l.data; editLazer = i; btnLazer.innerText = "Atualizar"; btnNovoLazer.style.display = "block"; }

function salvarMeta(){
    const m = { nome: nomeMeta.value, valor: parseBRL(valorMeta.value), data: dataMeta.value };
    if(!m.nome || m.valor <= 0) return avisar("âš ï¸ Preencha os campos");
    if(editMeta === null) metas.push(m); else metas[editMeta] = m;
    novaMeta(); atualizarTudo();
}
function novaMeta(){ editMeta = null; nomeMeta.value = ""; valorMeta.value = ""; dataMeta.value = ""; btnMeta.innerText = "Salvar meta"; btnNovaMeta.style.display = "none"; }
function editarMeta(i){ const m = metas[i]; nomeMeta.value = m.nome; valorMeta.value = m.valor.toLocaleString('pt-BR',{minimumFractionDigits:2}); dataMeta.value = m.data; editMeta = i; btnMeta.innerText = "Atualizar"; btnNovaMeta.style.display = "block"; }

function salvarInvestimento(){
    const inv = { nome: nomeInv.value, valor: parseBRL(valorInv.value), tipo: tipoInv.value, data: dataInv.value };
    if(!inv.nome || inv.valor <= 0) return avisar("âš ï¸ Preencha os campos");
    if(editInvest === null) investimentos.push(inv); else investimentos[editInvest] = inv;
    novoInvestimento(); atualizarTudo();
}
function novoInvestimento(){ editInvest = null; nomeInv.value = ""; valorInv.value = ""; tipoInv.value = ""; dataInv.value = ""; btnInvest.innerText = "Salvar aporte"; btnNovoInvest.style.display = "none"; }
function editarInvestimento(i){ const inv = investimentos[i]; nomeInv.value = inv.nome; valorInv.value = inv.valor.toLocaleString('pt-BR',{minimumFractionDigits:2}); tipoInv.value = inv.tipo; dataInv.value = inv.data; editInvest = i; btnInvest.innerText = "Atualizar"; btnNovoInvest.style.display = "block"; }

function atualizarTudo(){
    // Render Cards Despesas
    document.getElementById("listaDespesas").innerHTML = despesas.map((item, i) => `
        <div class="item-card">
            <div class="item-linha"><span class="item-label">Nome</span><span>ğŸ“ ${item.nome}</span></div>
            <div class="item-linha"><span class="item-label">Valor</span><span class="item-valor-foco">${real(item.valor)}</span></div>
            <div class="item-linha"><span class="item-label">%</span><span>${calcularPercentual(item.valor)}</span></div>
            <div class="item-linha"><span class="item-label">Tipo</span><span>ğŸ§¾ ${item.tipo}</span></div>
            <div class="item-linha"><span class="item-label">Venc.</span><span>ğŸ“… ${formatarDataBR(item.venc)}</span></div>
            ${item.status === 'pago' ? `<div class="item-linha"><span class="item-label">Pag.</span><span>ğŸ“… ${formatarDataBR(item.pag)}</span></div>` : ''}
            <div class="item-linha"><span class="item-label">Status</span><span class="${item.status === 'pago' ? 'pago' : 'nao'}">${item.status === 'pago' ? 'âœ… Pago' : 'âŒ NÃ£o pago'}</span></div>
            <div class="acoes-card">
                <button class="editar" onclick="editarDespesa(${i})">Editar</button>
                <button class="excluir" onclick="perguntar('Excluir despesa?', () => { despesas.splice(${i},1); atualizarTudo(); })">Excluir</button>
            </div>
        </div>
    `).join('');

    // Render Cards Lazer
    document.getElementById("listaLazer").innerHTML = lazer.map((item, i) => `
        <div class="item-card">
            <div class="item-linha"><span class="item-label">Nome</span><span>ğŸ¡ ${item.nome}</span></div>
            <div class="item-linha"><span class="item-label">Valor</span><span class="item-valor-foco">${real(item.valor)}</span></div>
            <div class="item-linha"><span class="item-label">%</span><span>${calcularPercentual(item.valor)}</span></div>
            <div class="item-linha"><span class="item-label">Data</span><span>ğŸ“… ${formatarDataBR(item.data)}</span></div>
            <div class="acoes-card">
                <button class="editar" onclick="editarLazer(${i})">Editar</button>
                <button class="excluir" onclick="perguntar('Excluir lazer?', () => { lazer.splice(${i},1); atualizarTudo(); })">Excluir</button>
            </div>
        </div>
    `).join('');

    // Render Cards Metas
    document.getElementById("listaMetas").innerHTML = metas.map((item, i) => `
        <div class="item-card">
            <div class="item-linha"><span class="item-label">Nome</span><span>ğŸ¯ ${item.nome}</span></div>
            <div class="item-linha"><span class="item-label">Valor</span><span class="item-valor-foco">${real(item.valor)}</span></div>
            <div class="item-linha"><span class="item-label">%</span><span>${calcularPercentual(item.valor)}</span></div>
            <div class="item-linha"><span class="item-label">Data</span><span>ğŸ“… ${formatarDataBR(item.data)}</span></div>
            <div class="acoes-card">
                <button class="editar" onclick="editarMeta(${i})">Editar</button>
                <button class="excluir" onclick="perguntar('Excluir meta?', () => { metas.splice(${i},1); atualizarTudo(); })">Excluir</button>
            </div>
        </div>
    `).join('');

    // Render Cards Investimentos
    document.getElementById("listaInvestimentos").innerHTML = investimentos.map((item, i) => `
        <div class="item-card">
            <div class="item-linha"><span class="item-label">Nome</span><span>ğŸ“ˆ ${item.nome}</span></div>
            <div class="item-linha"><span class="item-label">Valor</span><span class="item-valor-foco">${real(item.valor)}</span></div>
            <div class="item-linha"><span class="item-label">%</span><span>${calcularPercentual(item.valor)}</span></div>
            <div class="item-linha"><span class="item-label">Tipo</span><span>ğŸ“Œ ${item.tipo}</span></div>
            <div class="item-linha"><span class="item-label">Data</span><span>ğŸ“… ${formatarDataBR(item.data)}</span></div>
            <div class="acoes-card">
                <button class="editar" onclick="editarInvestimento(${i})">Editar</button>
                <button class="excluir" onclick="perguntar('Excluir aporte?', () => { investimentos.splice(${i},1); atualizarTudo(); })">Excluir</button>
            </div>
        </div>
    `).join('');

    // CÃ¡lculos Resumo
    const calc = (arr) => arr.reduce((s, x) => s + x.valor, 0);
    const dPago = despesas.filter(d => d.status === 'pago');
    const dNao = despesas.filter(d => d.status === 'nao');
    const vPago = calc(dPago), vNao = calc(dNao);
    const vLazer = calc(lazer), vMetas = calc(metas);
    const vEmerg = calc(investimentos.filter(i => i.tipo === 'emergencia'));
    const vRes = calc(investimentos.filter(i => i.tipo === 'reserva'));
    const vInv = calc(investimentos.filter(i => i.tipo === 'investimento'));

    // Atualizar UI Resumo
    const setRes = (idV, idP, idQ, val) => {
        document.getElementById(idV).innerText = real(val);
        document.getElementById(idP).innerText = calcularPercentual(val);
        document.getElementById(idQ).innerText = 0; 
    };

    setRes("totalPago", "percPago", "qtdPago", vPago); document.getElementById("qtdPago").innerText = dPago.length;
    setRes("totalPendente", "percPendente", "qtdPendente", vNao); document.getElementById("qtdPendente").innerText = dNao.length;
    setRes("somaDespesasValor", "somaDespesasPerc", "qtdTotalDespesas", vPago + vNao); document.getElementById("qtdTotalDespesas").innerText = despesas.length;

    setRes("totalLazer", "percLazer", "qtdLazer", vLazer); document.getElementById("qtdLazer").innerText = lazer.length;
    setRes("somaLazerValor", "somaLazerPerc", "somaLazerQtd", vLazer); document.getElementById("somaLazerQtd").innerText = lazer.length;

    setRes("totalMetas", "percMetas", "qtdMetas", vMetas); document.getElementById("qtdMetas").innerText = metas.length;
    setRes("somaMetasValor", "somaMetasPerc", "somaMetasQtd", vMetas); document.getElementById("somaMetasQtd").innerText = metas.length;

    setRes("totalEmergencia", "percEmergencia", "qtdEmergencia", vEmerg); document.getElementById("qtdEmergencia").innerText = investimentos.filter(i=>i.tipo==='emergencia').length;
    setRes("totalReservas", "percReservas", "qtdReservas", vRes); document.getElementById("qtdReservas").innerText = investimentos.filter(i=>i.tipo==='reserva').length;
    setRes("totalInvest", "percInvest", "qtdInvest", vInv); document.getElementById("qtdInvest").innerText = investimentos.filter(i=>i.tipo==='investimento').length;
    setRes("somaInvValor", "somaInvPerc", "qtdTotalInv", vEmerg + vRes + vInv); document.getElementById("qtdTotalInv").innerText = investimentos.length;

    const saldo = salario - vPago - vLazer - vMetas - vEmerg - vRes - vInv;
    document.getElementById("displaySalario").innerText = real(salario);
    document.getElementById("saldoFinal").innerText = real(saldo);
    document.getElementById("percLivre").innerText = calcularPercentual(saldo);
    document.getElementById("saldoFinal").className = saldo >= 0 ? "positivo" : "negativo";

    // --- PROCURE ESTA PARTE NO FINAL DA FUNÃ‡ÃƒO atualizarTudo() ---
    const hum = document.getElementById("status-humor");
    let classeStatus = "";
    let emoji = "";

    if (saldo < 0) {
        classeStatus = "status-vermelho";
        emoji = "ğŸ˜­";
    } else if (saldo < 250) {
        classeStatus = "status-amarelo";
        emoji = "ğŸ˜";
    } else {
        classeStatus = "status-verde";
        emoji = "ğŸ˜Š";
    }

    // Aqui injetamos o texto "Status" com a cor + o emoji
    hum.innerHTML = `<span class="${classeStatus}">Status</span> ${emoji}`;

    salvarDados();
}

function salvarDados() { localStorage.setItem("fin_data", JSON.stringify({ salario, despesas, lazer, metas, investimentos, mes: selectMes.value, ano: selectAno.value })); }
function carregarDados() {
    const d = JSON.parse(localStorage.getItem("fin_data") || "{}");
    if(d.salario) { salario = d.salario; despesas = d.despesas; lazer = d.lazer; metas = d.metas; investimentos = d.investimentos; selectMes.value = d.mes; selectAno.value = d.ano; }
    atualizarTudo();
}
function zerarTudo() { perguntar("Limpar todos os dados?", () => { localStorage.clear(); location.reload(); }); }

const sAno = document.getElementById("selectAno");
for(let i=2024; i<=2030; i++) { const o = document.createElement("option"); o.value=i; o.text=i; sAno.add(o); }

carregarDados();
</script>
</body>
</html>
