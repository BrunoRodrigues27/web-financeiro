l<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle Financeiro</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=menu" />

<style>
* { box-sizing: border-box; }

body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    padding: 12px;
}

h1, h2 {
    text-align: center;
    color: #38bdf8;
}

h2 {
    font-size: 20px;
}

h3 {
    padding-left: 10px;
    margin: 0;
    margin-bottom: 15px;
    color: #38bdf8;
    font-size: 16px;
}

.container {
    background: #020617;
    padding: 12px;
    border-radius: 10px;
}

.section {
    margin-bottom: 20px;
    padding: 12px;
    border: 1px solid #1e293b;
    border-radius: 8px;
}

.salario-exibicao {
    background: #1e293b;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    margin-bottom: 15px;
    border: 2px solid #38bdf8;
    position: sticky;
    top: 10px;
    z-index: 100;
}

.salario-exibicao span {
    font-size: 1.2em;
    font-weight: bold;
    color: #38bdf8;
}

label {
    display: block;
    margin-top: 10px;
    font-size: 14px;
    color: #94a3b8;
}

input, select, button {
    width: 100%;
    padding: 12px;
    margin-top: 4px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
}

button {
    background: #38bdf8;
    color: #020617;
    font-weight: bold;
    cursor: pointer;
}

button.secundario { background: #64748b; color: #fff; }
button.excluir { background: #ef4444; color: #fff; }

.botoes {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.pago { color: #22c55e; font-weight: bold; }
.nao { color: #ef4444; font-weight: bold; }
.positivo { color: #22c55e; }
.negativo { color: #ef4444; }

table, tbody, tr, td { width: 100%; }

tr {
    border: 1px solid #1e293b;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    display: block;
}

td {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
}

td::before {
    content: attr(data-label);
    font-weight: bold;
    color: #94a3b8;
}

.acoes {
    display: flex;
    gap: 8px;
    margin-top: 8px;
}

.valor-tipo-estilizado {
    color: #e5e7eb;
    text-transform: capitalize;
}

.resumo-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
}

.resumo-card {
    background: #020617;
    border: 1px solid #1e293b;
    border-radius: 8px;
    padding: 12px;
}

.resumo-card.destaque {
    border: 2px solid #38bdf8;
    position: relative;
}

/* Adicionada apenas a classe para a borda vermelha sem mexer nos outros estilos */
.resumo-card.destaque.saidas-estilo {
    border-color: #ef4444;
    margin-bottom: 10px;
}

#status-humor {
    position: absolute;
    top: 10px;
    right: 12px;
    font-size: 13px;
    font-weight: bold;
    text-transform: uppercase;
}

.resumo-linha {
    display: grid;
    grid-template-columns: 1fr 80px 55px 15px; 
    align-items: center;
    margin-top: 8px;
    font-size: 14px;
    gap: 12px;
}

.resumo-linha.total-grupo {
    margin-top: 12px;
    padding-top: 8px;
    border-top: 1px dashed #334155;
}

.resumo-linha span {
    color: #94a3b8;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.qtd-label {
    color: #38bdf8;
    font-size: 12px;
    text-align: right;
}

#toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
}

.toast {
    background: #1e293b;
    color: #fff;
    padding: 15px 20px;
    border-radius: 8px;
    border-left: 6px solid #38bdf8;
    margin-bottom: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}

#confirm-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    z-index: 10001;
    align-items: center;
    justify-content: center;
}

.confirm-box {
    background: #020617;
    border: 2px solid #38bdf8;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    max-width: 320px;
    width: 90%;
}

.bloquinho-titulo {
    display: block;
    font-size: 12px;
    font-weight: bold;
    color: #38bdf8;
    margin-bottom: 8px;
    border-bottom: 1px solid #334155;
    padding-bottom: 4px;
    text-transform: uppercase;
}

div.caixa-menu {
    text-align: center;
    margin-top: 15px;
    margin-bottom: 10px;
    width: 100%;
}

span.icone {
    font-size: 1.5em;
    cursor: pointer;
    width: 100%;
}

div#expandir-inputs-dispesa,
div#expandir-investimento,
div#expandir-metas,
div#expandir-lazer {
    display: none;
}

div.lista-geral {
    display: block;
    max-height: 300px;
    overflow-y: auto;
}

button.salvar {
    margin-top: 20px;
    margin-bottom: 20px;
}

.resumo-totais {
    margin-top: 20px;
    padding: 12px;
    border: 2px dashed #334155;
    border-radius: 10px;
    background: #020617;
}

.resumo-total-linha {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    font-size: 15px;
    border-bottom: 1px dashed #1e293b;
}

.resumo-total-linha:last-child {
    border-bottom: none;
}

.resumo-total-linha span {
    color: #94a3b8;
}

.resumo-total-linha strong {
    color: #e5e7eb;
}

.resumo-total-linha.destaque strong {
    color: #22c55e;
    font-size: 16px;
}

/* Estilo antigo das saidas removido para usar o padrÃ£o destaque */
.card-status { display: none; }

</style>
</head>

<body>

<div id="toast-container"></div>

<div id="confirm-overlay">
    <div class="confirm-box">
        <h3 id="confirm-title">Confirmar</h3>
        <p id="confirm-msg" style="margin-bottom: 20px;"></p>
        <div class="botoes">
            <button id="confirm-yes" class="excluir">Confirmar</button>
            <button id="confirm-no" class="secundario">Cancelar</button>
        </div>
    </div>
</div>

<h1>ğŸ“Š Controle Financeiro</h1>

<div class="container">

<div class="salario-exibicao">
    ğŸ’° SalÃ¡rio registrado: <span id="displaySalario">R$ 0,00</span>
    <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center;">
        <select id="selectMes">
            <option value="" disabled selected>MÃªs</option>
            <option value="1">Janeiro</option>
            <option value="2">Fevereiro</option>
            <option value="3">MarÃ§o</option>
            <option value="4">Abril</option>
            <option value="5">Maio</option>
            <option value="6">Junho</option>
            <option value="7">Julho</option>
            <option value="8">Agosto</option>
            <option value="9">Setembro</option>
            <option value="10">Outubro</option>
            <option value="11">Novembro</option>
            <option value="12">Dezembro</option>
        </select>

        <select id="selectAno" style="width: 100px;">
            <option value="" disabled selected>Ano</option>
        </select>
        <button class="excluir" onclick="zerarTudo()" style="width: 200px;">ğŸ§¹ Zerar</button>
    </div>
</div>

<div class="section">
<h2>ğŸ’° Configurar SalÃ¡rio</h2>
<input type="text" id="salarioInput" placeholder="ğŸ’² Digite seu salÃ¡rio" oninput="mascaraMoeda(this)" maxlength="12">
<button class="salvar" onclick="definirSalario()">Salvar salÃ¡rio</button>
</div>

<div class="section">
<h2>ğŸ§¾ Despesas</h2>
<input id="nomeDespesa" placeholder="ğŸ“ Nome da despesa" maxlength="40" autocomplete="off">
<div class="caixa-menu">
    <span id="icone-menu" class="icone material-symbols-outlined">menu</span>
</div>
<div id="expandir-inputs-dispesa">
    <input id="valorDespesa" type="text" placeholder="ğŸ’² Valor da conta" oninput="mascaraMoeda(this)" maxlength="9">
    <select id="tipoDespesa">
        <option value="" disabled selected>ğŸ“Œ Tipo da despesa</option>
        <option value="fixa">ğŸ§¾ Fixa</option>
        <option value="pontual">ğŸ§¾ Pontual</option>
    </select>
    <label>ğŸ“… Data de vencimento</label>
    <input type="date" id="vencimentoDespesa">
    <select id="statusDespesa" onchange="atualizarCampoPagamento()">
        <option value="" disabled selected>Status</option>
        <option value="nao">âŒ NÃ£o pago</option>
        <option value="pago">âœ… Pago</option>
    </select>
    <div id="campoPagamento" style="display:none">
        <label>ğŸ“… Data de pagamento</label>
        <input type="date" id="pagamentoDespesa">
    </div>
    <div class="botoes">
        <button class="salvar" id="btnDespesa" onclick="salvarDespesa()">Salvar despesa</button>
        <button id="btnNovaDespesa" class="secundario" onclick="novaDespesa()" style="display:none">Nova despesa</button>
    </div>
    <div class="lista-geral">
        <table><tbody id="listaDespesas"></tbody></table>
    </div>
</div>
</div>

<div class="section">
<h2 id="tituloInvest" >ğŸ’ Reservas | ğŸ“ˆ Investimentos</h2>
<input id="nomeInv" placeholder="ğŸ’ ğŸ“ˆ Nome da reserva ou investimento" maxlength="40" autocomplete="off">
    <div class="caixa-menu">
        <span id="menu-investimento" class="icone material-symbols-outlined">menu</span>
    </div>
<div id="expandir-investimento">
    <input id="valorInv" type="text" placeholder="ğŸ’² Valor" oninput="mascaraMoeda(this)" maxlength="9">
    <select id="tipoInv">
        <option value="" disabled selected>ğŸ“Œ Tipo</option>
        <option value="reserva">ğŸ’ Reserva</option>
        <option value="investimento">ğŸ“ˆ Investimento</option>
    </select>
    <label>ğŸ“… Data do aporte</label>
    <input type="date" id="dataInv">
    <div class="botoes">
        <button class="salvar" id="btnInvest" onclick="salvarInvestimento()">Salvar reserva ou investimento</button>
        <button id="btnNovoInvest" class="secundario" onclick="novoInvestimento()" style="display:none">Novo</button>
    </div>
    <div class="lista-geral">
        <table><tbody id="listaInvestimentos"></tbody></table>
    </div>
</div>
</div>

<div class="section">
<h2 id="tituloMetas">ğŸ¯ Metas</h2>
<input id="nomeMeta" placeholder="ğŸ¯ O que vocÃª quer comprar/alcanÃ§ar?" maxlength="40" autocomplete="off">
<div class="caixa-menu">
    <span id="menu-metas" class="icone material-symbols-outlined">menu</span>
</div>
<div id="expandir-metas">
    <input id="valorMeta" type="text" placeholder="ğŸ’² Valor para guardar este mÃªs" oninput="mascaraMoeda(this)" maxlength="9">
    <label>ğŸ“… Data limite ou do aporte</label>
    <input type="date" id="dataMeta">
    <div class="botoes">
        <button class="salvar" id="btnMeta" onclick="salvarMeta()">Salvar meta</button>
        <button id="btnNovaMeta" class="secundario" onclick="novaMeta()" style="display:none">Nova</button>
    </div>
    <div class="lista-geral">
        <table><tbody id="listaMetas"></tbody></table>
    </div>
</div>
</div>

<div class="section">
<h2 id="tituloLazer">ğŸ¿ Lazer</h2>
<input id="nomeLazer" placeholder="ğŸ¿ Nome da atividade ou gasto de lazer" maxlength="40" autocomplete="off">
<div class="caixa-menu">
    <span id="menu-lazer" class="icone material-symbols-outlined">menu</span>
</div>
<div id="expandir-lazer">
    <input id="valorLazer" type="text" placeholder="ğŸ’² Valor" oninput="mascaraMoeda(this)" maxlength="9">
    <label>ğŸ“… Data</label>
    <input type="date" id="dataLazer">
    <div class="botoes">
        <button class="salvar" id="btnLazer" onclick="salvarLazer()">Salvar lazer</button>
        <button id="btnNovoLazer" class="secundario" onclick="novoLazer()" style="display:none">Novo</button>
    </div>
    <div class="lista-geral">
        <table><tbody id="listaLazer"></tbody></table>
    </div>
</div>
</div>

<div class="section">
<h2>ğŸ“Š Resumo</h2>
<div class="resumo-grid">
    <div class="resumo-card">
        <h3>ğŸ§¾ Despesas</h3>
        <div class="resumo-linha">
            <span>âœ… Pago</span>
            <strong id="totalPago">R$ 0,00</strong>
            <strong id="percPago">0%</strong>
            <strong class="qtd-label" id="qtdPago">0</strong>
        </div>
        <div class="resumo-linha">
            <span>âŒ NÃ£o pago</span>
            <strong id="totalPendente">R$ 0,00</strong>
            <strong id="percPendente">0%</strong>
            <strong class="qtd-label" id="qtdPendente">0</strong>
        </div>
        <div class="resumo-linha total-grupo">
            <span>Soma Total</span>
            <strong id="somaDespesasValor">R$ 0,00</strong>
            <strong id="somaDespesasPerc">0%</strong>
            <strong class="qtd-label" id="qtdTotalDespesas">0</strong>
        </div>
    </div>

    <div class="resumo-card">
        <h3>ğŸ’ Reservas | ğŸ“ˆ Investimentos</h3>
        <div class="resumo-linha">
            <span>ğŸ’ Reservas</span>
            <strong id="totalReservas">R$ 0,00</strong>
            <strong id="percReservas">0%</strong>
            <strong class="qtd-label" id="qtdReservas">0</strong>
        </div>
        <div class="resumo-linha">
            <span>ğŸ“ˆ Investimentos</span>
            <strong id="totalInvestido">R$ 0,00</strong>
            <strong id="percInvestido">0%</strong>
            <strong class="qtd-label" id="qtdInvestido">0</strong>
        </div>
        <div class="resumo-linha total-grupo">
            <span>Soma Total</span>
            <strong id="somaInvestValor">R$ 0,00</strong>
            <strong id="somaInvestPerc">0%</strong>
            <strong class="qtd-label" id="qtdTotalInvest">0</strong>
        </div>
    </div>

    <div class="resumo-card">
        <h3>ğŸ¯ Metas | ğŸ¿ Lazer</h3>
        <div class="resumo-linha">
            <span>ğŸ¯ Metas</span>
            <strong id="resumoMetasValor">R$ 0,00</strong>
            <strong id="resumoMetasPerc">0%</strong>
            <strong class="qtd-label" id="qtdResumoMetas">0</strong>
        </div>
        <div class="resumo-linha">
            <span>ğŸ¿ Lazer</span>
            <strong id="resumoLazerValor">R$ 0,00</strong>
            <strong id="resumoLazerPerc">0%</strong>
            <strong class="qtd-label" id="qtdResumoLazer">0</strong>
        </div>
        <div class="resumo-linha total-grupo">
            <span>Soma Total</span>
            <strong id="somaMetasLazerValor">R$ 0,00</strong>
            <strong id="somaMetasLazerPerc">0%</strong>
            <strong class="qtd-label" id="qtdTotalMetasLazer">0</strong>
        </div>
    </div>
</div>

<div class="resumo-card destaque saidas-estilo">
    <h3 style="color:#ef4444">ğŸ“‰ SaÃ­das</h3>
    <div class="resumo-linha">
        <span>Total de saidas</span>
        <strong id="saidaTotal" style="color:#ef4444">R$ 0,00</strong>
        <strong id="saidaPercentual">0%</strong>
        <strong class="qtd-label" id="saidaQuantidade">0</strong>
    </div>
</div>

<div class="resumo-card destaque">
    <div id="status-humor"></div>
    <h3>ğŸ’µ Saldo</h3>
    <div class="resumo-linha">
        <span>DisponÃ­vel</span>
        <strong id="saldoFinal" class="positivo">R$ 0,00</strong>
        <strong id="percLivre">0%</strong>
        <span></span> </div>
</div>

</div>
</div>

<script>
let salario = 0;
let despesas = [];
let investimentos = [];
let metas = [];
let lazer = [];
let editDespesa = null;
let editInvest = null;
let editMeta = null;
let editLazer = null;

function mascaraMoeda(i) {
    let v = i.value.replace(/\D/g,'');
    v = (v/100).toFixed(2) + '';
    v = v.replace(".", ",");
    v = v.replace(/(\d)(\d{3})(\d{3}),/g, "$1.$2.$3,");
    v = v.replace(/(\d)(\d{3}),/g, "$1.$2,");
    i.value = v;
}

const parseBRL = (v) => {
    if (!v) return 0;
    return Number(v.replace(/\./g, '').replace(',', '.'));
};

const selectAno = document.getElementById("selectAno");
const anoAtual = new Date().getFullYear();
for(let i = anoAtual; i <= anoAtual + 20; i++){
    const option = document.createElement("option");
    option.value = i;
    option.text = i;
    selectAno.appendChild(option);
}

const real = v => v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

function avisar(msg, cor = "#38bdf8") {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.style.borderLeftColor = cor;
    toast.innerText = msg;
    container.appendChild(toast);
    setTimeout(() => { toast.style.opacity = '0'; setTimeout(()=>toast.remove(), 500); }, 3000);
}

function perguntar(msg, acao) {
    const overlay = document.getElementById('confirm-overlay');
    document.getElementById('confirm-msg').innerText = msg;
    overlay.style.display = 'flex';
    document.getElementById('confirm-yes').onclick = () => { acao(); overlay.style.display = 'none'; };
    document.getElementById('confirm-no').onclick = () => { overlay.style.display = 'none'; };
}

function formatarDataBR(data){
    if(!data) return "-";
    const [a,m,d] = data.split("-");
    return `${d}/${m}/${a}`;
}

function calcularPercentual(valor){
    if (salario <= 0) return "0%";
    return ((valor / salario) * 100).toFixed(2) + "%";
}

function definirSalario(){
    const novoSalario = parseBRL(salarioInput.value);
    if (novoSalario <= 0) { avisar("âš ï¸ Informe um salÃ¡rio vÃ¡lido.", "#ef4444"); return; }
    salario = novoSalario;
    salarioInput.value = "";
    atualizarTudo();
    avisar("ğŸ’° SalÃ¡rio salvo!", "#22c55e");
}

function atualizarCampoPagamento(){
    campoPagamento.style.display = statusDespesa.value === "pago" ? "block" : "none";
}

// FUNÃ‡Ã•ES DESPESAS
function salvarDespesa(){
    const d = {
        nome: nomeDespesa.value,
        valor: parseBRL(valorDespesa.value),
        tipo: tipoDespesa.value,
        venc: vencimentoDespesa.value,
        pag: statusDespesa.value === "pago" ? pagamentoDespesa.value : "",
        status: statusDespesa.value
    };
    if(!d.nome || d.valor <= 0 || !d.tipo || !d.status){ avisar("âš ï¸ Verifique os campos.", "#f59e0b"); return; }
    if (editDespesa === null) { despesas.push(d); avisar("âœ… Salvo!", "#22c55e"); }
    else { despesas[editDespesa] = d; avisar("âœ… Atualizado!", "#38bdf8"); }
    novaDespesa(); atualizarTudo();
}

function editarDespesa(i){
    const d = despesas[i];
    nomeDespesa.value = d.nome; 
    valorDespesa.value = d.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2}); 
    tipoDespesa.value = d.tipo;
    vencimentoDespesa.value = d.venc; statusDespesa.value = d.status; pagamentoDespesa.value = d.pag;
    atualizarCampoPagamento();
    editDespesa = i;
    btnDespesa.innerText = "Atualizar despesa";
    btnNovaDespesa.style.display = "block";
    document.querySelector(".section:nth-of-type(2)").scrollIntoView({ behavior: "smooth" });
}

function excluirDespesa(i){
    perguntar(`Remover "${despesas[i].nome}"?`, () => { despesas.splice(i,1); atualizarTudo(); avisar("ğŸ—‘ï¸ Removida!", "#ef4444"); });
}

function novaDespesa(){
    editDespesa = null;
    nomeDespesa.value = ""; valorDespesa.value = ""; tipoDespesa.value = "";
    vencimentoDespesa.value = ""; pagamentoDespesa.value = ""; statusDespesa.value = "";
    campoPagamento.style.display = "none";
    btnDespesa.innerText = "Salvar despesa";
    btnNovaDespesa.style.display = "none";
}

// FUNÃ‡Ã•ES INVESTIMENTOS
function salvarInvestimento(){
    const i = { nome: nomeInv.value, valor: parseBRL(valorInv.value), tipo: tipoInv.value, data: dataInv.value };
    if(!i.nome || i.valor <= 0 || !i.tipo || !i.data){ avisar("âš ï¸ Verifique os campos.", "#f59e0b"); return; }
    if (editInvest === null) { investimentos.push(i); avisar("âœ… Adicionado!", "#22c55e"); }
    else { investimentos[editInvest] = i; avisar("âœ… Atualizado!", "#38bdf8"); }
    novoInvestimento(); atualizarTudo();
}

function editarInvestimento(i){
    const v = investimentos[i];
    nomeInv.value = v.nome; valorInv.value = v.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2});
    tipoInv.value = v.tipo; dataInv.value = v.data;
    editInvest = i; btnInvest.innerText = "Atualizar"; btnNovoInvest.style.display = "block";
    document.getElementById("tituloInvest").scrollIntoView({ behavior: "smooth", block: "center" });
}

function excluirInvestimento(i){
    perguntar(`Remover "${investimentos[i].nome}"?`, () => { investimentos.splice(i,1); atualizarTudo(); avisar("ğŸ—‘ï¸ Removido!", "#ef4444"); });
}

function novoInvestimento(){
    editInvest = null; nomeInv.value = ""; valorInv.value = ""; tipoInv.value = ""; dataInv.value = "";
    btnInvest.innerText = "Salvar"; btnNovoInvest.style.display = "none";
}

// FUNÃ‡Ã•ES METAS
function salvarMeta() {
    const m = { nome: nomeMeta.value, valor: parseBRL(valorMeta.value), data: dataMeta.value };
    if(!m.nome || m.valor <= 0 || !m.data){ avisar("âš ï¸ Verifique os campos.", "#f59e0b"); return; }
    if (editMeta === null) { metas.push(m); avisar("ğŸ¯ Meta salva!", "#22c55e"); }
    else { metas[editMeta] = m; avisar("ğŸ¯ Atualizada!", "#38bdf8"); }
    novaMeta(); atualizarTudo();
}

function editarMeta(i) {
    const v = metas[i];
    nomeMeta.value = v.nome; valorMeta.value = v.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2});
    dataMeta.value = v.data;
    editMeta = i; btnMeta.innerText = "Atualizar"; btnNovaMeta.style.display = "block";
    document.getElementById("tituloMetas").scrollIntoView({ behavior: "smooth", block: "center" });
}

function excluirMeta(i) {
    perguntar(`Remover "${metas[i].nome}"?`, () => { metas.splice(i,1); atualizarTudo(); avisar("ğŸ—‘ï¸ Removida!", "#ef4444"); });
}

function novaMeta() {
    editMeta = null; nomeMeta.value = ""; valorMeta.value = ""; dataMeta.value = "";
    btnMeta.innerText = "Salvar meta"; btnNovaMeta.style.display = "none";
}

// FUNÃ‡Ã•ES LAZER
function salvarLazer() {
    const l = { nome: nomeLazer.value, valor: parseBRL(valorLazer.value), data: dataLazer.value };
    if(!l.nome || l.valor <= 0 || !l.data){ avisar("âš ï¸ Verifique os campos.", "#f59e0b"); return; }
    if (editLazer === null) { lazer.push(l); avisar("âœ… Lazer salvo!", "#22c55e"); }
    else { lazer[editLazer] = l; avisar("âœ… Atualizado!", "#38bdf8"); }
    novoLazer(); atualizarTudo();
}

function editarLazer(i) {
    const v = lazer[i];
    nomeLazer.value = v.nome; valorLazer.value = v.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2});
    dataLazer.value = v.data;
    editLazer = i; btnLazer.innerText = "Atualizar"; btnNovoLazer.style.display = "block";
    document.getElementById("tituloLazer").scrollIntoView({ behavior: "smooth", block: "center" });
}

function excluirLazer(i) {
    perguntar(`Remover "${lazer[i].nome}"?`, () => { lazer.splice(i,1); atualizarTudo(); avisar("ğŸ—‘ï¸ Removido!", "#ef4444"); });
}

function novoLazer() {
    editLazer = null; nomeLazer.value = ""; valorLazer.value = ""; dataLazer.value = "";
    btnLazer.innerText = "Salvar lazer"; btnNovoLazer.style.display = "none";
}

// LISTAGENS
function listarDespesas() {
    listaDespesas.innerHTML = despesas.map((d, i) => `
        <tr>
            <td data-label="Nome">ğŸ“ ${d.nome}</td>
            <td data-label="Valor">ğŸ’² ${real(d.valor)}</td>
            <td data-label="%">${calcularPercentual(d.valor)}</td>
            <td data-label="Tipo"><span class="valor-tipo-estilizado">ğŸ§¾ ${d.tipo}</span></td>
            <td data-label="Venc.">ğŸ“… ${formatarDataBR(d.venc)}</td>
            <td data-label="Pag.">ğŸ“… ${formatarDataBR(d.pag)}</td>
            <td data-label="Status" class="${d.status}">${d.status === "pago" ? "âœ… Pago" : "âŒ NÃ£o pago"}</td>
            <td class="acoes"><button onclick="editarDespesa(${i})">Editar</button><button class="excluir" onclick="excluirDespesa(${i})">Excluir</button></td>
        </tr>`).join('');
}

function listarInvestimentos(){
    listaInvestimentos.innerHTML = investimentos.map((i,idx)=>`
        <tr>
            <td data-label="Nome">ğŸ“ ${i.nome}</td>
            <td data-label="Valor">ğŸ’² ${real(i.valor)}</td>
            <td data-label="%">${calcularPercentual(i.valor)}</td>
            <td data-label="Tipo">${i.tipo === "reserva" ? "ğŸ’ Reserva" : "ğŸ“ˆ Investimento"}</td>
            <td data-label="Data">ğŸ“… ${formatarDataBR(i.data)}</td>
            <td class="acoes"><button onclick="editarInvestimento(${idx})">Editar</button><button class="excluir" onclick="excluirInvestimento(${idx})">Excluir</button></td>
        </tr>`).join('');
}

function listarMetas() {
    document.getElementById("listaMetas").innerHTML = metas.map((m, idx) => `
        <tr>
            <td data-label="Nome">ğŸ¯ ${m.nome}</td>
            <td data-label="Valor">ğŸ’² ${real(m.valor)}</td>
            <td data-label="%">${calcularPercentual(m.valor)}</td>
            <td data-label="Data">ğŸ“… ${formatarDataBR(m.data)}</td>
            <td class="acoes"><button onclick="editarMeta(${idx})">Editar</button><button class="excluir" onclick="excluirMeta(${idx})">Excluir</button></td>
        </tr>`).join('');
}

function listarLazer() {
    document.getElementById("listaLazer").innerHTML = lazer.map((l, idx) => `
        <tr>
            <td data-label="Nome">ğŸ¿ ${l.nome}</td>
            <td data-label="Valor">ğŸ’² ${real(l.valor)}</td>
            <td data-label="%">${calcularPercentual(l.valor)}</td>
            <td data-label="Data">ğŸ“… ${formatarDataBR(l.data)}</td>
            <td class="acoes"><button onclick="editarLazer(${idx})">Editar</button><button class="excluir" onclick="excluirLazer(${idx})">Excluir</button></td>
        </tr>`).join('');
}

function atualizarResumo(){
    // 1. CÃ¡lculos de Despesas
    const dPagos = despesas.filter(d => d.status === "pago");
    const dPendentes = despesas.filter(d => d.status === "nao");
    const valorPago = dPagos.reduce((s, d) => s + d.valor, 0);
    const valorPendente = dPendentes.reduce((s, d) => s + d.valor, 0);
    const valorTotalDesp = valorPago + valorPendente;

    // 2. CÃ¡lculos de Reservas e Investimentos
    const valorReservas = investimentos.filter(i => i.tipo === "reserva").reduce((s, i) => s + i.valor, 0);
    const valorInvest = investimentos.filter(i => i.tipo === "investimento").reduce((s, i) => s + i.valor, 0);
    const valorTotalInv = valorReservas + valorInvest;

    // 3. CÃ¡lculos de Metas e Lazer
    const valorTotalMetas = metas.reduce((s, m) => s + m.valor, 0);
    const valorTotalLazer = lazer.reduce((s, l) => s + l.valor, 0);
    const somaMetasLazer = valorTotalMetas + valorTotalLazer;

    // --- CORREÃ‡ÃƒO AQUI: TOTAL DE SAÃDAS ---
    // Agora "SaÃ­das" Ã© a soma de TUDO que nÃ£o Ã© salÃ¡rio
    const valorTotalSaidas = valorTotalDesp + valorTotalInv + somaMetasLazer;
    const totalItensSaida = despesas.length + investimentos.length + metas.length + lazer.length;

    // 4. AtualizaÃ§Ã£o da Caixa de SaÃ­das (Vermelha)
    const saidaTotalEl = document.getElementById("saidaTotal");
    const saidaPercentualEl = document.getElementById("saidaPercentual");
    const saidaQuantidadeEl = document.getElementById("saidaQuantidade");

    if(saidaTotalEl) saidaTotalEl.innerText = real(valorTotalSaidas);
    if(saidaPercentualEl) saidaPercentualEl.innerText = calcularPercentual(valorTotalSaidas);
    if(saidaQuantidadeEl) saidaQuantidadeEl.innerText = totalItensSaida;

    // 5. CÃ¡lculo do Saldo DisponÃ­vel
    const saldo = salario - valorTotalSaidas;

    // 6. AtualizaÃ§Ã£o da Caixa de Saldo (Azul)
    displaySalario.innerText = real(salario);
    saldoFinal.innerText = real(saldo);
    saldoFinal.className = saldo >= 0 ? "positivo" : "negativo";
    percLivre.innerText = calcularPercentual(saldo);

    // 7. Status Humor
    const statusDiv = document.getElementById("status-humor");
    if (salario === 0 && totalItensSaida === 0) { 
        statusDiv.innerHTML = ""; 
    } else if (saldo < 0) { 
        statusDiv.innerHTML = "Status: ğŸ˜­"; statusDiv.style.color = "#ef4444"; 
    } else if (saldo >= 0 && saldo <= 50) {
        statusDiv.innerHTML = "Status: ğŸ˜"; statusDiv.style.color = "#f59e0b"; 
    } else { 
        statusDiv.innerHTML = "Status: ğŸ˜Š"; statusDiv.style.color = "#22c55e"; 
    }

    // 8. AtualizaÃ§Ã£o dos Cards Individuais (os blocos de cima)
    // Despesas
    document.getElementById("totalPago").innerText = real(valorPago);
    document.getElementById("percPago").innerText = calcularPercentual(valorPago);
    document.getElementById("qtdPago").innerText = dPagos.length;
    document.getElementById("totalPendente").innerText = real(valorPendente);
    document.getElementById("percPendente").innerText = calcularPercentual(valorPendente);
    document.getElementById("qtdPendente").innerText = dPendentes.length;
    document.getElementById("somaDespesasValor").innerText = real(valorTotalDesp);
    document.getElementById("somaDespesasPerc").innerText = calcularPercentual(valorTotalDesp);
    document.getElementById("qtdTotalDespesas").innerText = despesas.length;

    // Investimentos
    document.getElementById("totalReservas").innerText = real(valorReservas);
    document.getElementById("percReservas").innerText = calcularPercentual(valorReservas);
    document.getElementById("qtdReservas").innerText = investimentos.filter(i => i.tipo === "reserva").length;
    document.getElementById("totalInvestido").innerText = real(valorInvest);
    document.getElementById("percInvestido").innerText = calcularPercentual(valorInvest);
    document.getElementById("qtdInvestido").innerText = investimentos.filter(i => i.tipo === "investimento").length;
    document.getElementById("somaInvestValor").innerText = real(valorTotalInv);
    document.getElementById("somaInvestPerc").innerText = calcularPercentual(valorTotalInv);
    document.getElementById("qtdTotalInvest").innerText = investimentos.length;

    // Metas/Lazer
    document.getElementById("resumoMetasValor").innerText = real(valorTotalMetas);
    document.getElementById("resumoMetasPerc").innerText = calcularPercentual(valorTotalMetas);
    document.getElementById("qtdResumoMetas").innerText = metas.length;
    document.getElementById("resumoLazerValor").innerText = real(valorTotalLazer);
    document.getElementById("resumoLazerPerc").innerText = calcularPercentual(valorTotalLazer);
    document.getElementById("qtdResumoLazer").innerText = lazer.length;
    document.getElementById("somaMetasLazerValor").innerText = real(somaMetasLazer);
    document.getElementById("somaMetasLazerPerc").innerText = calcularPercentual(somaMetasLazer);
    document.getElementById("qtdTotalMetasLazer").innerText = metas.length + lazer.length;
}

function atualizarTudo(){
    listarDespesas(); listarInvestimentos(); listarMetas(); listarLazer();
    atualizarResumo(); salvarDados();
}

const criarBloquinho = () => {
    const el = document.createElement("div");
    el.style.cssText = "position:absolute; background:#1e293b; border:2px solid #38bdf8; border-radius:8px; padding:10px; z-index:9999; display:none; max-height:200px; overflow-y:auto; width:300px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);";
    document.body.appendChild(el); return el;
};
const bDesp = criarBloquinho(); const bInv = criarBloquinho(); const bMeta = criarBloquinho(); const bLazer = criarBloquinho();

nomeDespesa.addEventListener("focus", () => {
    let html = "<span class='bloquinho-titulo'>contas jÃ¡ cadastradas:</span>";
    html += despesas.length ? despesas.map(d => `<div style='display:flex; justify-content:space-between; margin-bottom:5px; font-size:13px'><span>${d.nome}</span><span style='color:#38bdf8'>${real(d.valor)}</span></div>`).join('') : "<div style='color:#64748b; font-size:13px'>Vazio</div>";
    bDesp.innerHTML = html; const r = nomeDespesa.getBoundingClientRect();
    bDesp.style.top = r.bottom + window.scrollY + 5 + "px"; bDesp.style.left = r.left + window.scrollX + "px"; bDesp.style.display = "block";
});
nomeDespesa.addEventListener("blur", () => setTimeout(() => bDesp.style.display = "none", 200));

nomeInv.addEventListener("focus", () => {
    let html = "<span class='bloquinho-titulo'>cadastrados:</span>";
    html += investimentos.length ? investimentos.map(i => `<div style='display:flex; justify-content:space-between; margin-bottom:5px; font-size:13px'><span>${i.nome}</span><span style='color:#38bdf8'>${real(i.valor)}</span></div>`).join('') : "<div style='color:#64748b; font-size:13px'>Vazio</div>";
    bInv.innerHTML = html; const r = nomeInv.getBoundingClientRect();
    bInv.style.top = r.bottom + window.scrollY + 5 + "px"; bInv.style.left = r.left + window.scrollX + "px"; bInv.style.display = "block";
});
nomeInv.addEventListener("blur", () => setTimeout(() => bInv.style.display = "none", 200));

nomeMeta.addEventListener("focus", () => {
    let html = "<span class='bloquinho-titulo'>Metas salvas:</span>";
    html += metas.length ? metas.map(m => `<div style='display:flex; justify-content:space-between; margin-bottom:5px; font-size:13px'><span>${m.nome}</span><span style='color:#38bdf8'>${real(m.valor)}</span></div>`).join('') : "<div style='color:#64748b; font-size:13px'>Vazio</div>";
    bMeta.innerHTML = html; const r = nomeMeta.getBoundingClientRect();
    bMeta.style.top = r.bottom + window.scrollY + 5 + "px"; bMeta.style.left = r.left + window.scrollX + "px"; bMeta.style.display = "block";
});
nomeMeta.addEventListener("blur", () => setTimeout(() => bMeta.style.display = "none", 200));

nomeLazer.addEventListener("focus", () => {
    let html = "<span class='bloquinho-titulo'>lazer cadastrado:</span>";
    html += lazer.length ? lazer.map(l => `<div style='display:flex; justify-content:space-between; margin-bottom:5px; font-size:13px'><span>${l.nome}</span><span style='color:#38bdf8'>${real(l.valor)}</span></div>`).join('') : "<div style='color:#64748b; font-size:13px'>Vazio</div>";
    bLazer.innerHTML = html; const r = nomeLazer.getBoundingClientRect();
    bLazer.style.top = r.bottom + window.scrollY + 5 + "px"; bLazer.style.left = r.left + window.scrollX + "px"; bLazer.style.display = "block";
});
nomeLazer.addEventListener("blur", () => setTimeout(() => bLazer.style.display = "none", 200));

function salvarDados() {
    const dados = { salario, despesas, investimentos, metas, lazer, mesSelecionado: selectMes.value, anoSelecionado: selectAno.value };
    localStorage.setItem("controleFinanceiro", JSON.stringify(dados));
}

function carregarDados() {
    const salvo = localStorage.getItem("controleFinanceiro");
    if (!salvo) return;
    const dados = JSON.parse(salvo);
    salario = dados.salario || 0;
    despesas = dados.despesas || [];
    investimentos = dados.investimentos || [];
    metas = dados.metas || [];
    lazer = dados.lazer || [];
    if (dados.mesSelecionado) selectMes.value = dados.mesSelecionado;
    if (dados.anoSelecionado) selectAno.value = dados.anoSelecionado;
    atualizarTudo();
}

function zerarTudo() {
    perguntar("âš ï¸ Isso vai apagar TODOS os dados. Deseja continuar?", () => {
        salario = 0; despesas = []; investimentos = []; metas = []; lazer = [];
        selectMes.value = ""; selectAno.value = "";
        localStorage.removeItem("controleFinanceiro");
        atualizarTudo(); avisar("ğŸ§¹ Tudo zerado!", "#ef4444");
    });
}

document.getElementById('icone-menu').onclick = () => {
    let d = document.getElementById('expandir-inputs-dispesa');
    d.style.display = d.style.display === 'block' ? 'none' : 'block';
};
document.getElementById('menu-investimento').onclick = () => {
    let d = document.getElementById('expandir-investimento');
    d.style.display = d.style.display === 'block' ? 'none' : 'block';
};
document.getElementById('menu-metas').onclick = () => {
    let d = document.getElementById('expandir-metas');
    d.style.display = d.style.display === 'block' ? 'none' : 'block';
};
document.getElementById('menu-lazer').onclick = () => {
    let d = document.getElementById('expandir-lazer');
    d.style.display = d.style.display === 'block' ? 'none' : 'block';
};


carregarDados();
selectMes.onchange = salvarDados;
selectAno.onchange = salvarDados;

totalResumoDespesas.innerText = somaDespesasValor.innerText;
totalResumoInvest.innerText = somaInvestValor.innerText;
totalResumoMetas.innerText = resumoMetasValor.innerText;
totalResumoLazer.innerText = resumoLazerValor.innerText;
totalResumoSaldo.innerText = saldoFinal.innerText;
</script>
</body>
</html>